# チーム共有機能セットアップ手順

このドキュメントでは、タスク管理システムにチーム共有機能を有効化するための手順を説明します。

## 📋 概要

これまでLocalStorageを使用していたため、ブラウザごとに異なるデータが保存されていました。
今回の実装により、Supabaseデータベースを使用してチーム全体でデータを共有できるようになります。

### 主な機能

- ✅ プロジェクトとタスクのチーム間共有
- ✅ チームメンバー情報の共有
- ✅ ルーティンタスクとカテゴリーの共有
- ✅ リアルタイム同期（変更が即座に反映）
- ✅ 認証されたユーザー全員がアクセス可能

## 🚀 セットアップ手順

### ステップ 1: Supabase SQL Editorを開く

1. Supabaseダッシュボード (https://supabase.com/dashboard) にアクセス
2. プロジェクトを選択
3. 左側のメニューから「SQL Editor」をクリック

### ステップ 2: データベーステーブルを作成

1. 「New query」をクリック
2. `database_setup.sql` ファイルの内容を全てコピー
3. SQL Editorに貼り付け
4. 「Run」ボタンをクリックして実行

### ステップ 3: テーブルが正しく作成されたことを確認

1. 左側のメニューから「Table Editor」をクリック
2. 以下のテーブルが作成されていることを確認:
   - `projects` - プロジェクト情報
   - `tasks` - タスク情報
   - `team_members` - チームメンバー情報
   - `routine_tasks` - ルーティンタスク情報
   - `routine_categories` - ルーティンカテゴリー情報

### ステップ 4: アプリケーションを起動

```bash
npm run dev
```

これで完了です！

## 🎯 動作確認

### 基本動作の確認

1. ログインしてダッシュボードを開く
2. 新しいプロジェクトを作成
3. プロジェクトにタスクを追加
4. チームメンバーを追加

### リアルタイム同期の確認

1. 2つの異なるブラウザ（またはシークレットモード）で同じアカウントでログイン
2. 一方でプロジェクトやタスクを作成・編集
3. もう一方のブラウザで変更が自動的に反映されることを確認

### チーム共有の確認

1. 別のアカウントでログイン
2. 最初のアカウントで作成したプロジェクトやタスクが表示されることを確認
3. データの作成・編集・削除が可能なことを確認

## 📊 実装された機能

### 1. データベーステーブル

#### projects テーブル
- プロジェクト名、色、ステータス、進捗率
- タイムライン（開始日・終了日）
- 作成者情報

#### tasks テーブル
- タスク名、説明、ステータス、優先度、進捗率
- 担当者、開始日、期限、完了日
- 依存関係（dependencies配列）
- プロジェクトとの関連（外部キー）

#### team_members テーブル
- メンバー名、役割、アバター
- ユニーク制約付き（重複防止）

#### routine_tasks テーブル
- ルーティンタスク名、説明、時間、カテゴリー
- 担当者、繰り返し設定、所要時間
- ステータス（pending/completed/skipped）
- スキップ理由、完了・スキップ日時

#### routine_categories テーブル
- カテゴリー名、色、アイコン
- 説明、作成者情報

### 2. Row Level Security (RLS)

すべてのテーブルで以下のポリシーが適用されています:
- 認証済みユーザーは全てのデータを**閲覧可能**
- 認証済みユーザーは全てのデータを**作成可能**
- 認証済みユーザーは全てのデータを**更新可能**
- 認証済みユーザーは全てのデータを**削除可能**

### 3. リアルタイム同期

Supabase Realtimeを使用して、以下のイベントを自動的に検知:
- プロジェクトの作成・更新・削除
- タスクの作成・更新・削除
- チームメンバーの作成・更新・削除
- ルーティンタスクの作成・更新・削除
- ルーティンカテゴリーの作成・更新・削除

変更があると、接続中のすべてのクライアントに自動的に反映されます。

## 🔧 技術詳細

### 実装ファイル

#### ユーティリティ
- `src/utils/projectUtils.js` - プロジェクトとタスクのCRUD操作
- `src/utils/teamMemberUtils.js` - チームメンバーのCRUD操作
- `src/utils/routineCategoryUtils.js` - ルーティンカテゴリーのCRUD操作
- `src/utils/routineUtils.js` - ルーティンタスクのCRUD操作（既存）

#### コンポーネント
- `src/components/Dashboard.jsx` - リアルタイム同期とデータ読み込み
- `src/components/views/TimelineView.jsx` - プロジェクト・タスクの作成・編集UI
- `src/components/views/RoutineView.jsx` - ルーティンタスクの管理UI

#### データベース
- `database_setup.sql` - テーブル作成とRLSポリシー設定（完全版）

### データフロー

1. **読み込み時**
   - Dashboard.jsxのuseEffectでSupabaseからデータ取得
   - ローカルステート（useState）に保存
   - UIに表示

2. **作成・編集時**
   - ユーザーがフォームから入力
   - Supabaseに保存
   - 成功したらローカルステートを更新
   - リアルタイム同期により他のクライアントにも反映

3. **削除時**
   - 確認ダイアログを表示
   - Supabaseから削除
   - 成功したらローカルステートから削除
   - リアルタイム同期により他のクライアントにも反映

## ⚠️ 注意事項

### LocalStorageからの移行

現在LocalStorageに保存されているデータは自動的には移行されません。
必要に応じて、以下のいずれかの方法でデータを移行してください:

1. **手動移行**: 既存のプロジェクトとタスクを新しいシステムで再作成
2. **データエクスポート/インポート**: 設定パネルのデータ管理機能を使用

### パフォーマンス

- プロジェクト数が多い場合、初回読み込みに時間がかかる場合があります
- リアルタイム同期により、ネットワーク接続が必要です
- オフライン時は編集ができません

### セキュリティ

- 現在の設定では、認証済みユーザー全員がすべてのデータにアクセス可能です
- より細かい権限管理が必要な場合は、RLSポリシーのカスタマイズが必要です

## 🐛 トラブルシューティング

### データが表示されない

1. ブラウザのコンソールでエラーを確認
2. Supabaseの接続設定（.envファイル）を確認
3. テーブルが正しく作成されているか確認
4. ログインしているか確認

### リアルタイム同期が動作しない

1. SupabaseプロジェクトでRealtimeが有効になっているか確認
2. `database_setup.sql`のREALTIME PUBLICATIONの設定を確認
3. ブラウザのコンソールで接続エラーを確認

### エラーメッセージが表示される

- ブラウザのコンソールでエラー詳細を確認
- Supabaseダッシュボードの「Logs」でサーバーサイドのエラーを確認

## 📞 サポート

問題が解決しない場合は、以下の情報を含めてお問い合わせください:
- エラーメッセージ
- ブラウザのコンソールログ
- 実行した操作の手順

---

実装完了日: 2025年1月5日
最終更新日: 2025年1月5日
バージョン: 1.1.0（ルーティン機能追加）
