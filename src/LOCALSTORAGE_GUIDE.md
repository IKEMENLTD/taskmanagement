# LocalStorage機能ガイド

## 概要
このアプリケーションは、ユーザーのデータと設定をブラウザのLocalStorageに保存し、ページをリロードしても状態を維持します。

## 自動保存される項目

### 1. ルーティンデータ (`routineTasks`)
- 各日付のルーティンタスクの完了状態
- タスクの詳細情報
- 自動保存：タスクの完了/未完了を切り替えた瞬間

### 2. 表示設定 (`selectedView`)
- 現在選択中のビュー（タイムライン/チーム/ルーティン）
- 自動保存：ビューを切り替えた瞬間

### 3. テーマ設定 (`darkMode`)
- ダークモード/ライトモードの設定
- 自動保存：テーマを切り替えた瞬間

### 4. サイドバー状態 (`sidebarOpen`)
- サイドバーの開閉状態
- 自動保存：サイドバーを開閉した瞬間

### 5. フィルター設定 (`filterProject`, `filterMember`)
- 選択中のプロジェクトフィルター
- 選択中のメンバーフィルター
- 自動保存：フィルターを変更した瞬間

### 6. ルーティンビューモード (`routineViewMode`)
- マイビュー/チームビューの切り替え
- 自動保存：モードを切り替えた瞬間

## 設定パネルの使い方

### 設定パネルを開く
ヘッダー右上の歯車アイコン（⚙️）をクリックします。

### データ管理機能

#### 1. データをエクスポート
- 現在のすべてのデータをJSONファイルとしてダウンロードします
- ファイル名: `dashboard-backup-YYYY-MM-DD.json`
- 用途：バックアップ、他のブラウザへの移行

#### 2. データをインポート
- 以前エクスポートしたJSONファイルを読み込みます
- 現在のデータは上書きされます
- インポート後、ページが自動的にリロードされます

#### 3. ストレージ情報を表示
- 各データ項目のサイズ（バイト数）を確認できます
- どのデータがどれくらいの容量を使用しているかがわかります

#### 4. データのクリア

**ルーティンデータをクリア（黄色ボタン）**
- ルーティンタスクのデータのみを削除
- 設定（テーマ、フィルターなど）は保持されます
- 確認のため、2回クリックが必要です

**設定をクリア（オレンジボタン）**
- テーマ、フィルター、ビューなどの設定を削除
- ルーティンデータは保持されます
- 確認のため、2回クリックが必要です

**すべてのデータをクリア（赤色ボタン）**
- すべてのデータと設定を完全に削除
- 初期状態に戻ります
- 確認のため、2回クリックが必要です

## 技術的な詳細

### 実装ファイル

1. **`src/hooks/useLocalStorage.js`**
   - LocalStorageと同期するカスタムフック
   - 自動的にJSON形式でシリアライズ/デシリアライズ
   - エラーハンドリング実装済み

2. **`src/hooks/useRoutines.js`**
   - ルーティンデータ管理フック
   - useLocalStorageを使用してデータを永続化

3. **`src/utils/storageUtils.js`**
   - データ管理用のユーティリティ関数
   - エクスポート、インポート、クリア機能

4. **`src/components/layout/SettingsPanel.jsx`**
   - 設定パネルのUI実装
   - データ管理機能の視覚的なインターフェース

5. **`src/components/Dashboard.jsx`**
   - メインコンポーネント
   - 各種状態をLocalStorageと同期

### データ構造例

```json
{
  "routineTasks": {
    "2025-10-29": [
      {
        "id": 1,
        "name": "朝のストレッチ",
        "completed": true,
        "time": "07:00",
        "category": "health",
        "assignee": "田中",
        "description": "10分間の軽いストレッチ",
        "repeat": "毎日",
        "duration": 10,
        "streak": 15
      }
    ]
  },
  "selectedView": "routine",
  "darkMode": true,
  "sidebarOpen": true,
  "filterProject": "all",
  "filterMember": "all",
  "routineViewMode": "my"
}
```

## 注意事項

### LocalStorageの制限
- ブラウザごとに約5-10MBの容量制限があります
- データが大きくなりすぎる場合は、定期的に古いデータを削除してください

### プライバシー
- データはすべてブラウザのローカルストレージに保存されます
- サーバーには送信されません
- ブラウザのデータを削除すると、すべてのデータが失われます

### ブラウザ間の同期
- LocalStorageはブラウザ固有のため、異なるブラウザ間では自動同期されません
- データを移行する場合は、エクスポート/インポート機能を使用してください

### 推奨事項
- 重要なデータは定期的にエクスポートしてバックアップを取ることをお勧めします
- 月に1回程度、古いルーティンデータをクリアすることを推奨します

## トラブルシューティング

### データが保存されない
1. ブラウザのLocalStorageが有効になっているか確認
2. プライベートモード/シークレットモードでは動作が制限される場合があります
3. ブラウザの容量制限に達していないか確認

### データが消えた
1. ブラウザのデータクリアを実行していないか確認
2. バックアップファイルがあればインポートで復元可能

### インポートできない
1. JSONファイルが正しい形式か確認
2. ファイルが破損していないか確認
3. エクスポート時と同じアプリバージョンか確認

## 開発者向け情報

### カスタムフックの使用例

```javascript
import { useLocalStorage } from './hooks/useLocalStorage';

function MyComponent() {
  // 第1引数: LocalStorageのキー
  // 第2引数: 初期値
  const [value, setValue] = useLocalStorage('myKey', 'defaultValue');

  return (
    <button onClick={() => setValue('newValue')}>
      Update
    </button>
  );
}
```

### データ管理関数の使用例

```javascript
import { exportData, importData, clearAllData } from './utils/storageUtils';

// データのエクスポート
exportData(); // 自動的にダウンロード開始

// データのインポート
const success = importData(jsonString);
if (success) {
  console.log('インポート成功');
}

// データのクリア
clearAllData();
```
